<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap-theme.min.css" rel="stylesheet">
    <title>Data Handler</title>
    <style>
        #panel-handler #handler_display {
            white-space: pre;
            max-height: 50%;
            overflow: scroll;
        }

        #panel-handler #input {
            resize: none;
            width: 100%;
            overflow: scroll;
        }

        .container {
            flex-direction: column;
            align-items: center;
            margin-top: 30px;
            width: 80%;
            margin-left: 10%;
        }

        textarea {
            margin-bottom: 10px;
        }

        .btn-group {
            margin-bottom: 10px;
        }

        .jumbotron {
            padding: 15px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div id="panel-handler">
                    <h3 class="text-info text-center">
                        Data Handler
                    </h3>
                    <div class="btn-group">
                        <button class="btn btn-danger" id='clean'>Clean</button>
                        <button class="btn btn-warning" id='submit'>Submit</button>
                        <button class="btn btn-success" id='copy'>Copy</button>
                        <button data-toggle="dropdown" class="btn btn-info dropdown-toggle">
                            <span><b class="caret"></b></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li id="toQueryIdSet">
                                <a title='Make a large number of value transform into query able format.'>packageId</a>
                            </li>
                            <li id="toQueryFieldName">
                                <a
                                    title='Make rows or columns of field names transform into query able format.'>toQueryFieldName</a>
                            </li>
                            <li id="toTableRow">
                                <a title='Make field names from SOQL transform into a row of table.'>toTableRow</a>
                            </li>
                            <li id="toTableColumn">
                                <a
                                    title='Make field names from SOQL transform into a column of table.'>toTableColumn</a>
                            </li>
                            <li id="toSentenceFormate">
                                <a
                                    title='Make first words in a sentence transform into first character uppper format.'>toSentenceFormate</a>
                            </li>
                            <li id="toLabelFormate">
                                <a
                                    title='Make all words in input transform into first character uppper format.'>toLabelFormate</a>
                            </li>
                            <li id="toFieldsName">
                                <a
                                    title='Make field names from API Name transform into a searchable format.'>toFieldsName</a>
                            </li>
                            <li id="toFieldsNameNoSpace">
                                <a
                                    title='Make field names from API Name transform into a no space format.'>toFieldsNameNoSpace</a>
                            </li>
                            <li id="toCustomAPI">
                                <a title='Make field names from API Name transform into a query format.'>toCustomAPI</a>
                            </li>
                            <li id="toCsvTable">
                                <a title='Make a pure excel table transform into csv fromat'>toCsvTable</a>
                            </li>
                            <li id="toLower">
                                <a title='Transform to lower case'>toLower</a>
                            </li>
                            <li id="toUpper">
                                <a title='Transform to upper case'>toUpper</a>
                            </li>
                        </ul>
                    </div>
                    <textarea class="form-control block" id="handler_input" rows="10"></textarea>
                    <span class="label label-info">Display</span>
                    <div class="jumbotron well block" id="handler_display"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <script type="text/javascript">
        // z工具对象定义
        const z = {
            string: {
                // 设置剪贴板内容
                setClipBoard: function (element) {
                    if (element.val) {
                        navigator.clipboard.writeText(element.val())
                            .then(() => alert('已复制到剪贴板'))
                            .catch(err => console.error('复制失败:', err));
                    }
                },

                // 为每行添加包围字符
                surroundEachRows: function (str, prefix = '', suffix = '', skipEmpty = true, trim = true) {
                    if (!str) return '';
                    return str.split('\n')
                        .filter(line => !skipEmpty || line.trim())
                        .map(line => trim ? line.trim() : line)
                        .map(line => prefix + line + suffix)
                        .join('\n');
                },

                // SQL字段名格式转换
                replaceForSQL: function (str) {
                    if (!str) return '';
                    return str.split('\n')
                        .map(line => line.trim())
                        .filter(line => line)
                        .map(line => line.replace(/[^a-zA-Z0-9_]/g, '_'))
                        .join(',\n');
                },

                // 转换为表格格式
                replaceForTable: function (str, format = 0) {
                    if (!str) return '';
                    const lines = str.split('\n')
                        .map(line => line.trim())
                        .filter(line => line);

                    return format === 0 ?
                        lines.join(' | ') :
                        lines.join('\n');
                },

                // 句子格式化（首字母大写）
                formatSentence: function (str) {
                    if (!str) return '';
                    return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
                },

                // 标签格式化（每个单词首字母大写）
                formatLabel: function (str) {
                    if (!str) return '';
                    return str.split(' ')
                        .map(word => this.formatSentence(word))
                        .join(' ');
                },

                // 转换为字段名格式
                toFieldsName: function (str) {
                    if (!str) return '';
                    return str.replace(/([A-Z])/g, ' $1')
                        .trim()
                        .toLowerCase();
                },

                // 删除指定字符
                drop: function (str, char) {
                    if (!str) return '';
                    return str.replace(new RegExp(char, 'g'), '');
                },

                // 转换为自定义API名称
                toCustomObjecAPIName: function (str) {
                    if (!str) return '';
                    return this.formatLabel(str)
                        .replace(/\s+/g, '_')
                        .concat('__c');
                },

                // 转换为CSV表格格式
                packageTable: function (str) {
                    if (!str) return '';
                    return str.split('\n')
                        .map(line => line.trim())
                        .filter(line => line)
                        .map(line => line.split('\t').join(','))
                        .join('\n');
                },

                // 数组连接
                concatArray: function (arr, separator = '\n', skipEmpty = true, trim = true, callback = null) {
                    if (!arr || !arr.length) return '';
                    return arr
                        .filter(item => !skipEmpty || (trim ? item.trim() : item))
                        .map(item => trim ? item.trim() : item)
                        .map(item => callback ? callback(item) : item)
                        .join(separator);
                }
            }
        };

        // 事件处理代码
        let tmp = null;
        let result = null;

        $(document).ready(function () {
            $('li').click(function () {
                tmp = $('#handler_input').val();
            });

            $('[id*="submit"]').click(function () {
                $('#handler_input').val(result);
            });

            $('[id*="clean"]').click(function () {
                tmp = '';
                result = '';
                $('#handler_input').val('');
            });

            $('[id*="copy"]').click(function () {
                z.string.setClipBoard($('#handler_input'));
            });

            $('[id*="toQueryIdSet"]').click(function () {
                result = z.string.surroundEachRows(tmp, '\'', '\',', false, false);
            });

            $('[id*="toQueryFieldName"]').click(function () {
                result = z.string.replaceForSQL(tmp);
            });

            $('[id*="toTableRow"]').click(function () {
                result = z.string.replaceForTable(tmp);
            });

            $('[id*="toTableColumn"]').click(function () {
                result = z.string.replaceForTable(tmp, 1);
            });

            $('[id*="toSentenceFormate"]').click(function () {
                tmp = tmp.split('\n');
                result = z.string.concatArray(tmp, '\n', false, true, function (str) {
                    return z.string.formatSentence(str);
                });
            });

            $('[id*="toLabelFormate"]').click(function () {
                tmp = tmp.split('\n');
                result = z.string.concatArray(tmp, '\n', false, true, function (str) {
                    return z.string.formatLabel(str);
                });
            });

            $('[id*="toFieldsName"]').click(function () {
                tmp = tmp.split('\n');
                result = z.string.concatArray(tmp, '\n', false, true, function (str) {
                    return z.string.toFieldsName(str);
                });
            });

            $('[id*="toFieldsNameNoSpace"]').click(function () {
                tmp = tmp.split('\n');
                result = z.string.concatArray(tmp, '\n', false, true, function (str) {
                    return z.string.drop(str, ' ');
                });
            });

            $('[id*="toCustomAPI"]').click(function () {
                tmp = tmp.split('\n');
                result = z.string.concatArray(tmp, '\n', false, true, function (str) {
                    return z.string.toCustomObjecAPIName(str);
                });
            });

            $('[id*="toCsvTable"]').click(function () {
                result = z.string.packageTable(tmp);
            });

            $('[id*="toLower"]').click(function () {
                result = tmp.toLocaleLowerCase();
            });

            $('[id*="toUpper"]').click(function () {
                result = tmp.toLocaleUpperCase();
            });

            $('li').click(function () {
                $('#handler_display').html(result);
            });
        });
    </script>
</body>

</html>